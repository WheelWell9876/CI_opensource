<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom API Crafter - CI Sentinel Editor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/editor.css') }}">
</head>
<body>
  <header>
    <div class="logo">
      <span class="logo-title">CI Sentinel - API Editor</span>
    </div>
    <nav>
      <ul class="nav-links-container">
        <li><a href="{{ url_for('main.index') }}">Home</a></li>
        <li><a href="{{ url_for('main.about') }}">About</a></li>
        <li><a href="{{ url_for('main.datasets') }}">Datasets</a></li>
        <li><a href="{{ url_for('main.docs_page') }}">Docs</a></li>
      </ul>
    </nav>
  </header>
  <div class="editor-wrapper">
    <!-- Left Panel: Options -->
    <div class="editor-options">
      <h2>Options &amp; Fields</h2>
      <!-- Collapsible: API Options -->
      <div class="collapsible">
        <div class="collapsible-header active">API Options</div>
        <div class="collapsible-content active">
          <!-- Source Selection -->
          <div class="input-group">
            <label for="source-type-select">Source Type:</label>
            <select id="source-type-select">
              <option value="provided">Provided API</option>
              <option value="custom">Custom API</option>
            </select>
          </div>
          <div class="input-group" id="provided-api-group">
            <label for="provided-api-select">Choose an API:</label>
            <select id="provided-api-select">
              <!-- Options will be populated by JS -->
            </select>
          </div>
          <!-- API URL Input -->
          <div class="input-group">
            <label for="api-url-input">API URL:</label>
            <input type="text" id="api-url-input" placeholder="https://services.example.com/..." />
            <button id="load-fields">Load Fields</button>
          </div>
          <!-- API Fields Section -->
          <div class="collapsible">
            <div class="collapsible-header active">API Fields</div>
            <div class="collapsible-content active" id="fields-container">
              <!-- Fields will be inserted here -->
            </div>
          </div>
          <!-- Spatial Inputs -->
          <div class="collapsible">
            <div class="collapsible-header">Spatial Inputs</div>
            <div class="collapsible-content">
              <div class="input-group">
                <label for="spatial-input-select">Spatial Input:</label>
                <select id="spatial-input-select">
                  <option value="None">None</option>
                  <option value="Envelope">Envelope</option>
                </select>
              </div>
              <div id="spatial-envelope-options" style="display: none;">
                <div class="input-group">
                  <label for="inSR-input">Input Spatial Reference:</label>
                  <input type="text" id="inSR-input" value="4326" />
                </div>
                <div class="input-group">
                  <label for="spatial-rel-select">Spatial Relationship:</label>
                  <select id="spatial-rel-select">
                    <option value="esriSpatialRelIntersects">Intersects</option>
                    <option value="esriSpatialRelContains">Contains</option>
                    <option value="esriSpatialRelCrosses">Crosses</option>
                    <option value="esriSpatialRelEnvelopeIntersects">EnvelopeIntersects</option>
                    <option value="esriSpatialRelIndexIntersects">IndexIntersects</option>
                    <option value="esriSpatialRelOverlaps">Overlaps</option>
                    <option value="esriSpatialRelTouches">Touches</option>
                    <option value="esriSpatialRelWithin">Within</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <!-- Output Options -->
          <div class="collapsible">
            <div class="collapsible-header">Output Options</div>
            <div class="collapsible-content">
              <div class="bento-box">
                <label>
                  <input type="checkbox" id="out-return-geometry" checked> Return Geometry
                </label>
                <label>
                  <input type="checkbox" id="out-return-ids"> Return IDs Only
                </label>
                <label>
                  <input type="checkbox" id="out-return-count"> Return Count Only
                </label>
                <div class="input-group">
                  <label for="outSR-input">Output Spatial Reference:</label>
                  <input type="text" id="outSR-input" value="4326" />
                </div>
                <div class="input-group">
                  <label for="where-input">Where Clause:</label>
                  <input type="text" id="where-input" placeholder="e.g. 1=1" value="1=1" />
                </div>
                <div class="input-group">
                  <div class="header">Advanced Query Parameters</div>
                  <textarea id="advanced-params" placeholder='{"order_by_fields": "STATE_NAME ASC"}'></textarea>
                </div>
              </div>
            </div>
          </div>
          <!-- Number of Objects to Load -->
          <div class="input-group">
            <label for="preview-limit">Number of Objects to Load:</label>
            <input type="number" id="preview-limit" value="10" min="1" max="100">
          </div>
        </div>
      </div>

      <!-- New JSON Source Selection -->
      <div class="input-group">
        <label for="json-source-select">JSON Source:</label>
        <select id="json-source-select">
          <option value="provided">Use Provided JSON</option>
          <option value="custom" selected>Create Your Own JSON</option>
        </select>
      </div>

      <!-- Collapsible: JSON Options -->
      <div class="collapsible">
        <div class="collapsible-header">JSON Options</div>
        <div class="collapsible-content">
          <!-- JSON Upload -->
          <div class="input-group">
            <label for="json-upload">Upload JSON Configuration:</label>
            <input type="file" id="json-upload" accept=".json">
          </div>

          <!-- Category and Dataset Controls -->
          <div id="json-category-dataset-controls" class="bento-box">
            <h3>Category &amp; Dataset Options</h3>
            <label for="category-type-select">Choose Option:</label>
            <select id="category-type-select">
              <option value="new">Create New Category</option>
              <option value="existing">Add to Existing Category</option>
            </select>
            <div id="new-category-input-container" style="display: none;">
              <label for="new-category-input">New Category Name:</label>
              <input type="text" id="new-category-input" placeholder="Enter new category name">
            </div>
            <div id="json-dataset-selector" class="bento-box">
              <h3>Select Dataset</h3>
              <label for="dataset-select">Dataset:</label>
              <select id="dataset-select">
                <option value="">-- Select Dataset --</option>
                <!-- Dynamically populated with saved datasets -->
              </select>
            </div>
          </div>

          <!-- Saved JSON Browser Controls -->
          <div id="json-saved-controls" class="bento-box">
            <h3>Saved JSONs</h3>
            <div class="saved-json-section">
              <label for="saved-dataset-select">Dataset JSONs:</label>
              <select id="saved-dataset-select">
                <option value="">-- Select Dataset JSON --</option>
              </select>
              <button id="load-dataset-json">Load Dataset</button>
            </div>
            <div class="saved-json-section">
              <label for="saved-category-select">Category JSONs:</label>
              <select id="saved-category-select">
                <option value="">-- Select Category JSON --</option>
              </select>
              <button id="load-category-json">Load Category</button>
            </div>
            <div class="saved-json-section">
              <label for="saved-mode-select">Mode JSONs:</label>
              <select id="saved-mode-select">
                <option value="">-- Select Mode JSON --</option>
              </select>
              <button id="load-mode-json">Load Mode</button>
            </div>
          </div>

          <!-- Browser-like Tab System for Dataset Editors -->
          <div id="json-editor-tabs" class="tab-bar">
            <!-- One tab is open by default; additional tabs can be added -->
            <button class="tab active" data-tab="dataset-tab-1">Dataset 1<span class="close-tab"> x</span></button>
            <button class="tab add-tab" id="add-dataset-tab">+</button>
          </div>

          <!-- Interactive JSON Builder Preview (Dataset Editor) -->
          <div id="json-builder" class="bento-box nested-container">
            <!-- The active dataset editor is rendered here -->
            <div id="dataset-tab-1" class="dataset-editor" style="display: block;">
              <div class="editor-header">
                <label>Dataset Name:
                  <input type="text" class="dataset-name" placeholder="Enter dataset name" />
                </label>
                <label>Dataset Link:
                  <input type="text" class="dataset-link" placeholder="Enter dataset link" />
                </label>
              </div>
              <div class="editor-body">
                <!-- Use classes for these containers so each tab can have its own. -->
                <div class="qualitative-fields-container"></div>
                <div class="quantitative-fields-container"></div>
                <div class="fields-level"></div>
              </div>
            </div>
          </div>

          <!-- Buttons for saving/fusing JSONs -->
          <div class="button-group">
            <button id="process-fields-btn">Process Fields</button>
            <button id="create-json-btn">Create JSON</button>
            <button id="save-dataset-json-btn">Save Dataset JSON</button>
            <button id="fuse-category-btn">Fuse Datasets into Category</button>
            <button id="fuse-mode-btn">Fuse Categories into Mode</button>
          </div>
        </div>
      </div>

      <!-- Collapsible: Python Options -->
      <div class="collapsible">
        <div class="collapsible-header">Python Options</div>
        <div class="collapsible-content">
          <div class="collapsible">
            <div class="collapsible-header">Quant/Qual Selector</div>
            <div class="collapsible-content" id="quant-qual-section">
              <p>Select quantitative and qualitative fields here.</p>
            </div>
          </div>
        </div>
      </div>

      <button id="update-preview">Update Preview</button>
    </div>

    <!-- Resizer Element -->
    <div class="resizer"></div>

    <!-- Right Panel: Live Preview -->
    <div class="editor-preview">
      <div class="preview-header">
        <label for="code-type-select">Preview Type:</label>
        <select id="code-type-select">
          <option value="api_response" selected>API Response</option>
          <option value="api">API Creation</option>
          <option value="json">JSON Creation</option>
          <option value="python">Python Function</option>
          <option value="txt">Text Summary</option>
        </select>
      </div>
      <div class="code-container">
        <button id="copy-code" title="Copy to Clipboard">Copy</button>
        <textarea id="code-preview" spellcheck="false"></textarea>
      </div>
    </div>
  </div>

  <!-- Load scripts in order -->
  <script src="{{ url_for('static', filename='scripts/jsonEditor/editor.js') }}"></script>
  <script src="{{ url_for('static', filename='scripts/jsonEditor/jsonEditor.js') }}"></script>
  <script src="{{ url_for('static', filename='scripts/jsonEditor/jsonManager.js') }}"></script>
  <script>
    // On page load, ensure the default tab is active.
    document.addEventListener('DOMContentLoaded', function() {
      // The default tab "dataset-tab-1" is already in the HTML.
    });
  </script>
</body>
</html>
